module "app_service" {
  source = "azurerm_app_service"

  app_service_name               = "sc-app-prcHostingPlanNameTidy-dev-01"
  public_network_access_enabled  = false
  vnet_integration_required      = false
  ritm_number                    = "RITM12345"
  client_affinity_enabled        = false
  client_certificate_enabled     = false
  client_certificate_mode        = "Required"

  site_config = {
    always_on                 = true
    default_documents         = ["index.html"]
    ftps_state                = "FtpsOnly"
    http2_enabled             = false
    load_balancing_mode       = "LeastRequests"
    managed_pipeline_mode     = "Integrated"
    scm_use_main_ip_restriction = false
    use_32_bit_worker         = false
    vnet_route_all_enabled    = true
    worker_count              = 1
    application_stack = {
      php_version = ""
    }
  }

  app_setting = [
    { name = "CURRENT_STACK", value = "dotnetcore" },
    { name = "WEBSITE_RUN_FROM_PACKAGE", value = "1" },
    { name = "WEBSITE_WEBDEPLOY_USE_SCM", value = "false" },
    { name = "USE_ASE", value = var.use_ase ? "true" : "false" },
    { name = "PRC_PROPERTIES", value = var.prc_properties }
  ]

  connection_string = {
    connection_string01 = {
      name  = "coreSqlDatabaseNameTidy"
      type  = "Custom"
      value = "123#abc"
    },
    connection_string02 = {
      name  = "POC02"
      type  = "Custom"
      value = "123#abc"
    },
    connection_string03 = {
      name  = "Prc Hosting Plan Connection String"
      type  = "Custom"
      value = var.prc_hosting_plan_connection_string
    }
  }

  enable_backup = true
  backup_settings = {
    enabled                  = true
    name                     = "sc-app-prcHostingPlanNameTidy-dev-01-backup"
    schedule = {
      frequency_interval       = 7
      frequency_unit           = "Day"
      retention_period_days    = 30
      keep_at_least_one_backup = false
    }
  }
}
